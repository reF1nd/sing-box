name: reF1nd Test Build

on:
  workflow_dispatch:
    inputs:
      tag:
        description: "Test tag name containing 'reF1nd'"
        required: true
        type: string
        default: "v1.0.0-reF1nd-test"

jobs:
  test_syntax:
    name: Test Workflow Syntax
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Test version extraction
        run: |
          VERSION="${{ inputs.tag }}"
          echo "Version: ${VERSION}"
          echo "version=${VERSION}" >> $GITHUB_OUTPUT
        id: version

      - name: Test message formatting
        run: |
          MESSAGE="ğŸ¯ **sing-box reF1nd æµ‹è¯•æŠ¥å‘Š**%0A%0Aâœ… è¯­æ³•æµ‹è¯•æˆåŠŸ%0A%0AğŸ·ï¸ **ç‰ˆæœ¬**: \`${{ steps.version.outputs.version }}\`%0AğŸ• **æµ‹è¯•æ—¶é—´**: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          echo "Message formatted successfully"
          echo "MESSAGE=${MESSAGE}" >> $GITHUB_ENV

      - name: Test file operations
        run: |
          mkdir -p test_dist
          echo "test binary" > test_dist/sing-box
          echo "âœ… File operations test passed"

      - name: Test packaging simulation
        run: |
          echo "Simulating package creation..."
          echo "-s dir" > .fpm_test
          echo "--name sing-box" >> .fpm_test
          echo "--version 1.0.0" >> .fpm_test
          echo "âœ… Package configuration test passed"

      - name: Test artifact upload
        uses: actions/upload-artifact@v4
        with:
          name: test-artifact
          path: test_dist/
          retention-days: 1

      - name: Summary
        run: |
          echo "ğŸ‰ æ‰€æœ‰è¯­æ³•æµ‹è¯•é€šè¿‡ï¼"
          echo "âœ… ç‰ˆæœ¬æå–: ${{ steps.version.outputs.version }}"
          echo "âœ… æ¶ˆæ¯æ ¼å¼åŒ–: æˆåŠŸ"
          echo "âœ… æ–‡ä»¶æ“ä½œ: æˆåŠŸ"
          echo "âœ… æ‰“åŒ…é…ç½®: æˆåŠŸ"
          echo "âœ… äº§ç‰©ä¸Šä¼ : æˆåŠŸ"
